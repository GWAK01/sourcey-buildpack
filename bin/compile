#!/bin/bash

BUILD_PATH=$1
CACHE_PATH=$2

set -e

mkdir -p $BUILD_PATH $CACHE_PATH

PERL_VERSION=5.20.2
RELEASE=r2

if [ -d $CACHE_PATH/perl-$PERL_VERSION -a -r $CACHE_PATH/perl-$PERL_VERSION/$RELEASE ]; then
   echo "- using perl from cache ($CACHE_PATH)"
   cp --archive $CACHE_PATH/perl-$PERL_VERSION $BUILD_PATH
else 
   echo "- rebuilding perl"
   `dirname $0`/../lib/language_pack/perl.sh $PERL_VERSION $BUILD_PATH/perl-$PERL_VERSION
   rm -rf $CACHE_PATH/perl-$PERL_VERSION
   cp --archive $BUILD_PATH/perl-$PERL_VERSION $CACHE_PATH 
   touch $CACHE_PATH/perl-$PERL_VERSION/$RELEASE
fi

export PATH=$BUILD_PATH/perl-$PERL_VERSION/bin:$PATH

perl -v

cpanm --notest --installdeps $BUILD_PATH

